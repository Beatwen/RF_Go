"use strict";(self.webpackChunkrf_go_docs=self.webpackChunkrf_go_docs||[]).push([[8559],{1596:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"api/overview","title":"API Licensing","description":"Vue d\'ensemble","source":"@site/docs/api/overview.md","sourceDirName":"api","slug":"/api/overview","permalink":"/RF_Go/api/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/Beatwen/RF_Go/tree/main/docs/api/overview.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Protocoles Sp\xe9cifiques aux Appareils","permalink":"/RF_Go/protocols/device-specific"},"next":{"title":"Configuration de l\'Environnement de D\xe9veloppement","permalink":"/RF_Go/development/setup"}}');var s=r(4848),t=r(8453);const a={},c="API Licensing",l={},d=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Authentication",id:"authentication",level:2},{value:"1. Register User",id:"1-register-user",level:3},{value:"2. Login User",id:"2-login-user",level:3},{value:"3. Refresh Token",id:"3-refresh-token",level:3},{value:"4. Logout",id:"4-logout",level:3},{value:"License Management",id:"license-management",level:2},{value:"1. Activate License",id:"1-activate-license",level:3},{value:"2. Validate License",id:"2-validate-license",level:3},{value:"Headers Standard",id:"headers-standard",level:2},{value:"Implementation",id:"implementation",level:2},{value:"ApiService",id:"apiservice",level:3},{value:"Token Storage",id:"token-storage",level:3},{value:"Flux d&#39;authentification",id:"flux-dauthentification",level:2},{value:"Gestion offline",id:"gestion-offline",level:2}];function o(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"api-licensing",children:"API Licensing"})}),"\n",(0,s.jsx)(n.h2,{id:"vue-densemble",children:"Vue d'ensemble"}),"\n",(0,s.jsxs)(n.p,{children:["RF.Go utilise une ",(0,s.jsx)(n.strong,{children:"API de licensing externe"})," uniquement pour l'authentification utilisateur et la gestion des licenses. L'application fonctionne ",(0,s.jsx)(n.strong,{children:"enti\xe8rement offline"})," pour toutes les fonctionnalit\xe9s RF - l'API sert exclusivement au licensing."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Base URL"})," : ",(0,s.jsx)(n.code,{children:"https://api.licensing.noobastudio.be"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"API Key"})," : Fournie dans les headers ",(0,s.jsx)(n.code,{children:"X-API-KEY"})]}),"\n",(0,s.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsx)(n.h3,{id:"1-register-user",children:"1. Register User"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"})," : ",(0,s.jsx)(n.code,{children:"POST /auth/register"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Usage"})," : Cr\xe9ation d'un nouveau compte utilisateur"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /auth/register\r\nContent-Type: application/json\r\nX-API-KEY: {apiKey}\r\nX-DEVICE-ID: {deviceIdentifier}\r\n\r\n{\r\n    "firstName": "string",\r\n    "lastName": "string", \r\n    "email": "string",\r\n    "password": "string",\r\n    "acceptedTerms": true\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Response"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n    "message": "User registered successfully",\r\n    "user": {\r\n        "id": 123,\r\n        "userName": "user@example.com",\r\n        "firstName": "John",\r\n        "lastName": "Doe",\r\n        "email": "user@example.com",\r\n        "emailConfirmed": false,\r\n        "createdAt": "2024-01-15T10:30:00Z"\r\n    },\r\n    "client": {\r\n        "clientId": "client-uuid",\r\n        "clientSecret": "secret-string"\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-login-user",children:"2. Login User"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"})," : ",(0,s.jsx)(n.code,{children:"POST /auth/login"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Usage"})," : Authentification utilisateur et r\xe9cup\xe9ration du token"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"POST /auth/login\r\nContent-Type: application/x-www-form-urlencoded\r\nX-API-KEY: {apiKey}\r\nX-DEVICE-ID: {deviceIdentifier}\r\n\r\nemail={email}&password={password}&username={email}&client_id={clientId}&client_secret={clientSecret}&grant_type=password\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Response"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n    "message": "Login successful",\r\n    "user": {\r\n        "id": 123,\r\n        "userName": "user@example.com",\r\n        "firstName": "John",\r\n        "lastName": "Doe"\r\n    },\r\n    "token": {\r\n        "accessToken": "jwt-access-token",\r\n        "refreshToken": "jwt-refresh-token",\r\n        "expiresIn": 3600,\r\n        "tokenType": "Bearer"\r\n    },\r\n    "redirectTo": "/license"\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-refresh-token",children:"3. Refresh Token"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"})," : ",(0,s.jsx)(n.code,{children:"POST /auth/refresh"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Usage"})," : Renouvellement du token d'acc\xe8s"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /auth/refresh\r\nContent-Type: application/json\r\nX-API-KEY: {apiKey}\r\nX-DEVICE-ID: {deviceIdentifier}\r\nAuthorization: Bearer {expiredAccessToken}\r\n\r\n{\r\n    "refreshToken": "jwt-refresh-token"\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Response"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n    "accessToken": "new-jwt-access-token",\r\n    "refreshToken": "new-jwt-refresh-token",\r\n    "expiresIn": 3600\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-logout",children:"4. Logout"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"})," : ",(0,s.jsx)(n.code,{children:"POST /auth/logout"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Usage"})," : D\xe9connexion et invalidation des tokens"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /auth/logout\r\nContent-Type: application/json\r\nX-API-KEY: {apiKey}\r\nAuthorization: Bearer {accessToken}\r\n\r\n{\r\n    "token": "jwt-refresh-token"\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"license-management",children:"License Management"}),"\n",(0,s.jsx)(n.h3,{id:"1-activate-license",children:"1. Activate License"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"})," : ",(0,s.jsx)(n.code,{children:"POST /licenses/activate-and-validate"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Usage"})," : Activation d'une license sur un device"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /licenses/activate-and-validate\r\nContent-Type: application/json\r\nX-API-KEY: {apiKey}\r\nX-DEVICE-ID: {deviceIdentifier}\r\nX-USER-KEY: {userId}\r\nAuthorization: Bearer {accessToken}\r\n\r\n{\r\n    "licenseKey": "license-key-string"\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Response"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n    "valid": true,\r\n    "message": "License activated successfully"\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-validate-license",children:"2. Validate License"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Endpoint"})," : ",(0,s.jsx)(n.code,{children:"POST /licenses/validate"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Usage"})," : Validation d'une license existante au d\xe9marrage"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /licenses/validate\r\nContent-Type: application/json\r\nX-API-KEY: {apiKey}\r\nX-USER-KEY: {userId}\r\nX-DEVICE-ID: {deviceIdentifier}\r\nX-LICENSE-KEY: {licenseKey}\r\nAuthorization: Bearer {accessToken}\r\n\r\n{\r\n    "licenseKey": "license-key-string",\r\n    "deviceId": "device-identifier"\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Response"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n    "valid": true,\r\n    "message": "License is valid",\r\n    "deviceId": "device-identifier",\r\n    "licenseType": "Standard"\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"headers-standard",children:"Headers Standard"}),"\n",(0,s.jsx)(n.p,{children:"Tous les appels API utilisent ces headers :"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Header"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Obligatoire"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-API-KEY"})}),(0,s.jsx)(n.td,{children:"Cl\xe9 API statique"}),(0,s.jsx)(n.td,{children:"\u2705 Toujours"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-DEVICE-ID"})}),(0,s.jsx)(n.td,{children:"Identifiant unique du device"}),(0,s.jsx)(n.td,{children:"\u2705 Toujours"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-USER-KEY"})}),(0,s.jsx)(n.td,{children:"ID utilisateur"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Apr\xe8s login"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-LICENSE-KEY"})}),(0,s.jsx)(n.td,{children:"Cl\xe9 de license"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Apr\xe8s activation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Authorization"})}),(0,s.jsx)(n.td,{children:"Bearer token JWT"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Apr\xe8s login"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"apiservice",children:"ApiService"}),"\n",(0,s.jsx)(n.p,{children:"Service centralis\xe9 pour tous les appels API :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'public class ApiService\r\n{\r\n    private readonly HttpClient _httpClient;\r\n\r\n    public ApiService(HttpClient httpClient)\r\n    {\r\n        _httpClient = httpClient;\r\n        _httpClient.BaseAddress = new Uri(AppConfig.ApiBaseUrl);\r\n        _httpClient.DefaultRequestHeaders.Add("X-API-KEY", AppConfig.ApiKey);\r\n    }\r\n\r\n    private async Task AddSecureStorageHeadersAsync()\r\n    {\r\n        var userKey = await SecureStorage.GetAsync("userKey");\r\n        var licenseKey = await SecureStorage.GetAsync("licenseKey");\r\n        var deviceIdentifier = await GUID.GetOrCreateDeviceIdentifier();\r\n        var token = await SecureStorage.GetAsync("access_token");\r\n\r\n        // Dynamic headers based on available data\r\n        if (!string.IsNullOrEmpty(userKey))\r\n            _httpClient.DefaultRequestHeaders.Add("X-USER-KEY", userKey);\r\n        if (!string.IsNullOrEmpty(licenseKey))\r\n            _httpClient.DefaultRequestHeaders.Add("X-LICENSE-KEY", licenseKey);\r\n        if (!string.IsNullOrEmpty(deviceIdentifier))\r\n            _httpClient.DefaultRequestHeaders.Add("X-DEVICE-ID", deviceIdentifier);\r\n        if (!string.IsNullOrEmpty(token))\r\n            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"token-storage",children:"Token Storage"}),"\n",(0,s.jsx)(n.p,{children:"Gestion s\xe9curis\xe9e des tokens :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'public static class TokenStorage\r\n{\r\n    public static async Task SaveAccessTokenAsync(string token) \r\n        => await SecureStorage.SetAsync("access_token", token);\r\n    \r\n    public static async Task<string> GetAccessTokenAsync() \r\n        => await SecureStorage.GetAsync("access_token");\r\n    \r\n    public static async Task SaveRefreshTokenAsync(string token) \r\n        => await SecureStorage.SetAsync("refresh_token", token);\r\n    \r\n    public static async Task<string> GetRefreshTokenAsync() \r\n        => await SecureStorage.GetAsync("refresh_token");\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"flux-dauthentification",children:"Flux d'authentification"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant App as RF.Go App\r\n    participant API as Licensing API\r\n    participant Storage as SecureStorage\r\n\r\n    App->>API: POST /auth/register (new user)\r\n    API--\x3e>App: client credentials\r\n    App->>Storage: Save client credentials\r\n\r\n    App->>API: POST /auth/login\r\n    API--\x3e>App: access + refresh tokens\r\n    App->>Storage: Save tokens + user data\r\n\r\n    App->>API: POST /licenses/activate-and-validate\r\n    API--\x3e>App: license validation\r\n    App->>Storage: Save license key\r\n\r\n    App->>API: POST /licenses/validate (startup)\r\n    API--\x3e>App: license status\r\n    App->>App: Start offline RF functions"}),"\n",(0,s.jsx)(n.h2,{id:"gestion-offline",children:"Gestion offline"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important"})," : Seule l'authentification n\xe9cessite une connexion internet. Une fois la license valid\xe9e, RF.Go fonctionne ",(0,s.jsx)(n.strong,{children:"enti\xe8rement offline"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 D\xe9couverte des devices RF (mDNS local)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Calculs d'intermodulations (algorithmes locaux)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Configuration des devices (protocols directs)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Base de donn\xe9es locale (SQLite)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["L'API n'est ",(0,s.jsx)(n.strong,{children:"jamais"})," sollicit\xe9e pour les fonctionnalit\xe9s RF principales."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);